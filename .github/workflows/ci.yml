name: Run Tests

on:
  push:
    branches:
      - "**"
  pull_request:
    branches:
      - "**"

jobs:
  wpf-tests:
    runs-on: windows-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up .NET
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: "7.0"

      - name: Download and Extract Java 17
        run: |
          curl -L -o openjdk.zip https://github.com/adoptium/temurin17-binaries/releases/download/jdk-17.0.8.1%2B1/OpenJDK17U-jdk_x64_windows_hotspot_17.0.8.1_1.zip
          mkdir openjdk
          tar -xf openjdk.zip -C openjdk --strip-components=1
          echo "Extracted OpenJDK to openjdk directory"
          set JAVA_HOME=%cd%\openjdk
          set PATH=%JAVA_HOME%\bin;%PATH%
        shell: cmd

      - name: Verify Java Version
        run: java -version

      - name: Download and Extract Neo4j
        run: |
          curl -L -o neo4j.zip https://neo4j.com/artifact.php?name=neo4j-community-5.5.0-windows.zip
          mkdir neo4j
          tar -xf neo4j.zip -C neo4j --strip-components=1
          dir neo4j
          dir neo4j\bin

      - name: Install and Start Neo4j
        run: |
          cmd /c "neo4j\bin\neo4j.bat install-service"
          cmd /c "neo4j\bin\neo4j.bat start"
        env:
          NEO4J_AUTH: "neo4j/testpassword"

      - name: Install dependencies
        run: dotnet restore

      - name: Run WPF tests
        env:
          CI: true
          NEO4J_AUTH: "neo4j/testpassword"
        run: dotnet test
